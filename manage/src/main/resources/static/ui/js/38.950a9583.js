"use strict";(self["webpackChunkstatic"]=self["webpackChunkstatic"]||[]).push([[38],{1038:function(e,a,l){l.r(a),l.d(a,{default:function(){return f}});l(7658);var t=l(3396),o=l(7139),u=l(1685),m=l(4870),p=l(4834),r=l(3824),i=l(7327),n=l(1799);class d{constructor(e,a,l,t){(0,i.Z)(this,"appName",void 0),(0,i.Z)(this,"dataCenter",void 0),(0,i.Z)(this,"ip",void 0),(0,i.Z)(this,"port",void 0),(0,i.Z)(this,"myChart",null),(0,i.Z)(this,"getKey",(()=>this.ip+":"+this.port)),(0,i.Z)(this,"queryData",(e=>{let a={appName:e.appName,quotaName:e.quotaName,dataCenter:this.dataCenter,ip:this.ip,port:this.port,timeType:e.timeType,time:e.time};(0,u.Z)({url:"/hmis/monitor/qd/queryQuotaDatas/v1.0",method:"post",data:a}).then((e=>{if(1==e.data.code){const a=e.data.body;let l=[],t=[];a.forEach((e=>{l.push(e.fmtCollectTime),t.push(e.dataValue)})),null==this.myChart&&(this.myChart=n.S1(document.getElementById(this.getKey()))),this.myChart.setOption({legend:{type:"plain"},tooltip:{trigger:"axis",formatter:"时间: {b}<br/>值: {c}"},xAxis:{data:l},yAxis:{},series:[{name:this.ip+":"+this.port,data:t,type:"line",symbolSize:0,label:{show:!1},areaStyle:{color:"#B1FF54A8",opacity:.3},lineStyle:{color:"#B1FF54A8",width:1}}]})}})).catch((e=>{(0,p.Jy)("操作结果","请求异常","error")}))})),this.appName=e,this.dataCenter=a,this.ip=l,this.port=t}}const s={class:"time"},c=["id"],h={class:"dialog-footer"},w={class:"dialog-footer"};var b=(0,t.aZ)({__name:"QuotaList",setup(e){(0,m.iH)(!1);const a=(0,m.iH)(!1),l=(0,m.iH)(!1),i=(0,m.iH)("全屏"),n=()=>{l.value=!l.value,"全屏"==i.value?i.value="缩小":i.value="全屏"},b=(0,m.qj)({quotaTypes:[{value:"Data",label:"数据"},{value:"Notify",label:"通知"},{value:"Heartbeat",label:"心跳"}]}),y=(0,m.qj)({page:{pageNum:1,pageSize:10,total:0},appName:"",quotaName:"",quotaDesc:"",quotaType:""}),f=(0,m.qj)({data:[]}),g=({row:e})=>"是"==e.hasThreshold?"warning-row":"",W=()=>{console.log("提交表单"),(0,u.Z)({url:"/hmis/monitor/rule/queryQuotaInfos/v1.0",method:"post",params:y.page,data:y}).then((e=>{1==e.data.code&&(f.data=e.data.body.list,y.page.total=e.data.body.total)})).catch((e=>{console.error(e),(0,p.Jy)("操作结果","请求异常","error")}))},v=(0,m.iH)(!1),k=(0,m.qj)({appName:"",quotaName:"",checkCount:3,notifyTimeoutSec:300,phoneNums:"",enable_b:!1,enable:-1,rule:""}),N=e=>{v.value=!0,k.appName=e.row.appName,k.quotaName=e.row.quotaName,k.enable=-1,(0,u.Z)({url:"/hmis/monitor/rule/queryAllQuotaWarnRules/v1.0",method:"post",data:k}).then((e=>{if(1==e.data.code){let a=e.data.body;if(a.length>0){let e=a[0];k.checkCount=e.checkCount,k.notifyTimeoutSec=e.notifyTimeoutSec,k.phoneNums=e.phoneNums,k.enable=e.enable,k.enable_b=1==e.enable,k.rule=e.rule}else k.checkCount=3,k.notifyTimeoutSec=300,k.phoneNums="",k.enable=0,k.enable_b=!1,k.rule=""}}))},_=()=>{v.value=!1,k.enable=k.enable_b?1:0,(0,u.Z)({url:"/hmis/monitor/rule/saveQuotaWarnRule/v1.0",method:"post",data:k}).then((e=>{1==e.data.code?(0,p.Jy)("操作结果","操作成功","success"):(0,p.Jy)("操作结果","操作失败","error")})).catch((e=>{(0,p.Jy)("操作结果","请求异常","error")}))},V=e=>{r.Z.push({path:"/monitor/instanceList",query:e.row})},q=()=>{const e=new Date;return e.setTime(e.getTime()-108e5),[e,new Date]},C=(0,m.iH)(!1),U=(0,m.qj)({timeType:"3",time:q(),appName:"",quotaName:""}),T=(0,m.qj)([]),z=e=>{U.appName=e.row.appName,U.quotaName=e.row.quotaName,(0,u.Z)({url:"/hmis/manage/agent/kafkaIn/queryInstanceList/v1.0",method:"post",params:{pageNum:1,pageSize:100},data:{appName:e.row.appName}}).then((e=>{1==e.data.code&&(a.value=!0,T.length=0,e.data.body.list.forEach((e=>{T.push(new d(y.appName,e.dataCenter,e.ip,e.port))})),S())})).catch((e=>{(0,p.Jy)("操作结果","请求异常","error")}))},D=()=>{"custom"==U.timeType?(C.value=!0,U.time=q()):(C.value=!1,U.time=[]),S()},S=()=>{T.forEach((e=>{e.queryData(U)}))};return(0,t.bv)((()=>W())),(e,u)=>{const m=(0,t.up)("el-input"),p=(0,t.up)("el-form-item"),r=(0,t.up)("el-option"),d=(0,t.up)("el-select"),q=(0,t.up)("el-button"),Z=(0,t.up)("el-form"),x=(0,t.up)("el-table-column"),H=(0,t.up)("el-table"),j=(0,t.up)("el-pagination"),J=(0,t.up)("el-radio-button"),A=(0,t.up)("el-radio-group"),Q=(0,t.up)("el-date-picker"),E=(0,t.up)("el-dialog"),F=(0,t.up)("el-switch");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(Z,{inline:!0,class:"demo-form-inline"},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{label:"应用名称",prop:"appName"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:y.appName,"onUpdate:modelValue":u[0]||(u[0]=e=>y.appName=e),placeholder:"请输入关键字..."},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,{label:"指标名称",prop:"quotaName"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:y.quotaName,"onUpdate:modelValue":u[1]||(u[1]=e=>y.quotaName=e),placeholder:"请输入关键字..."},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,{label:"指标描述",prop:"quotaDesc"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:y.quotaDesc,"onUpdate:modelValue":u[2]||(u[2]=e=>y.quotaDesc=e),placeholder:"请输入关键字..."},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,{label:"指标类型",prop:"quotaType"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:y.quotaType,"onUpdate:modelValue":u[3]||(u[3]=e=>y.quotaType=e),class:"m-2",placeholder:"请选择",size:"large"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(b.quotaTypes,((e,a)=>((0,t.wg)(),(0,t.j4)(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(q,{type:"primary",onClick:W},{default:(0,t.w5)((()=>[(0,t.Uk)("查询")])),_:1})])),_:1})])),_:1}),(0,t.Wm)(H,{data:f.data,style:{width:"100%"},border:!0,"table-layout":"fixed",size:"small","row-class-name":g},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{fixed:"left",label:"操作",width:"150","header-align":"center",align:"center"},{default:(0,t.w5)((e=>[(0,t.Wm)(q,{link:"",type:"primary",size:"small",onClick:a=>N(e)},{default:(0,t.w5)((()=>[(0,t.Uk)("阈值")])),_:2},1032,["onClick"]),(0,t.Wm)(q,{link:"",type:"primary",size:"small",onClick:a=>V(e)},{default:(0,t.w5)((()=>[(0,t.Uk)("实例")])),_:2},1032,["onClick"]),(0,t.Wm)(q,{link:"",type:"primary",size:"small",onClick:a=>z(e)},{default:(0,t.w5)((()=>[(0,t.Uk)("趋势")])),_:2},1032,["onClick"])])),_:1}),(0,t.Wm)(x,{prop:"hasThreshold",label:"是否配置阈值","show-overflow-tooltip":!0,"header-align":"center"}),(0,t.Wm)(x,{prop:"appName",label:"应用名称","show-overflow-tooltip":!0,"header-align":"center"}),(0,t.Wm)(x,{prop:"quotaName",label:"指标名称","show-overflow-tooltip":!0,"header-align":"center"}),(0,t.Wm)(x,{prop:"quotaDesc",label:"指标描述","show-overflow-tooltip":!0,"header-align":"center"}),(0,t.Wm)(x,{prop:"quotaUnit",label:"指标单位","show-overflow-tooltip":!0,"header-align":"center"}),(0,t.Wm)(x,{prop:"quotaType",label:"指标类型","show-overflow-tooltip":!0,"header-align":"center"}),(0,t.Wm)(x,{prop:"cycleTime",label:"采集周期","show-overflow-tooltip":!0,"header-align":"center"}),(0,t.Wm)(x,{prop:"cycleUnit",label:"周期单位","show-overflow-tooltip":!0,"header-align":"center"})])),_:1},8,["data"]),(0,t.Wm)(j,{class:"page","page-size":y.page.pageSize,"onUpdate:page-size":u[4]||(u[4]=e=>y.page.pageSize=e),"current-page":y.page.pageNum,"onUpdate:current-page":u[5]||(u[5]=e=>y.page.pageNum=e),layout:"->, total, sizes, prev, pager, next, jumper",total:y.page.total,"onUpdate:total":u[6]||(u[6]=e=>y.page.total=e),onSizeChange:W,onCurrentChange:W,onPrevClick:W,onNextClick:W,small:!0,background:!0,"page-sizes":[5,10,20,50,100]},null,8,["page-size","current-page","total"]),(0,t.Wm)(E,{modelValue:a.value,"onUpdate:modelValue":u[10]||(u[10]=e=>a.value=e),title:U.quotaName,"destroy-on-close":"",fullscreen:l.value,top:"5vh"},{footer:(0,t.w5)((()=>[(0,t._)("span",h,[(0,t.Wm)(q,{onClick:S,type:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)("查询")])),_:1}),(0,t.Wm)(q,{onClick:n,type:"success"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(i.value),1)])),_:1}),(0,t.Wm)(q,{onClick:u[9]||(u[9]=e=>a.value=!1),type:"info"},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1})])])),default:(0,t.w5)((()=>[(0,t.Wm)(Z,{model:U},{default:(0,t.w5)((()=>[(0,t.Wm)(A,{modelValue:U.timeType,"onUpdate:modelValue":u[7]||(u[7]=e=>U.timeType=e),onChange:D},{default:(0,t.w5)((()=>[(0,t.Wm)(J,{label:"1",size:"small",border:""},{default:(0,t.w5)((()=>[(0,t.Uk)("最近1小时")])),_:1}),(0,t.Wm)(J,{label:"3",size:"small",border:""},{default:(0,t.w5)((()=>[(0,t.Uk)("最近3小时")])),_:1}),(0,t.Wm)(J,{label:"6",size:"small",border:""},{default:(0,t.w5)((()=>[(0,t.Uk)("最近6小时")])),_:1}),(0,t.Wm)(J,{label:"12",size:"small",border:""},{default:(0,t.w5)((()=>[(0,t.Uk)("最近12小时")])),_:1}),(0,t.Wm)(J,{label:"24",size:"small",border:""},{default:(0,t.w5)((()=>[(0,t.Uk)("最近24小时")])),_:1}),(0,t.Wm)(J,{label:"custom",size:"small",border:""},{default:(0,t.w5)((()=>[(0,t.Uk)("自定义")])),_:1})])),_:1},8,["modelValue"]),(0,t._)("div",s,[C.value?((0,t.wg)(),(0,t.j4)(Q,{key:0,modelValue:U.time,"onUpdate:modelValue":u[8]||(u[8]=e=>U.time=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",size:"small"},null,8,["modelValue"])):(0,t.kq)("",!0)])])),_:1},8,["model"]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(T,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{id:e.ip+":"+e.port,class:"trend"},null,8,c)))),256))])),_:1},8,["modelValue","title","fullscreen"]),(0,t.Wm)(E,{modelValue:v.value,"onUpdate:modelValue":u[19]||(u[19]=e=>v.value=e),title:"趋势图","destroy-on-close":"",top:"5vh"},{footer:(0,t.w5)((()=>[(0,t._)("span",w,[(0,t.Wm)(q,{onClick:_,type:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)("保存")])),_:1}),(0,t.Wm)(q,{onClick:u[18]||(u[18]=e=>v.value=!1),type:"info"},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1})])])),default:(0,t.w5)((()=>[(0,t.Wm)(Z,{model:k,"label-width":"120px"},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{label:"应用名称："},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:k.appName,"onUpdate:modelValue":u[11]||(u[11]=e=>k.appName=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,{label:"指标名称："},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:k.quotaName,"onUpdate:modelValue":u[12]||(u[12]=e=>k.quotaName=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,{label:"检查次数："},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:k.checkCount,"onUpdate:modelValue":u[13]||(u[13]=e=>k.checkCount=e),type:"number"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,{label:"警告超时(秒)："},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:k.notifyTimeoutSec,"onUpdate:modelValue":u[14]||(u[14]=e=>k.notifyTimeoutSec=e),type:"number"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,{label:"通知号码："},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:k.phoneNums,"onUpdate:modelValue":u[15]||(u[15]=e=>k.phoneNums=e),type:"textarea",row:"5"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,{label:"是否启用："},{default:(0,t.w5)((()=>[(0,t.Wm)(F,{modelValue:k.enable_b,"onUpdate:modelValue":u[16]||(u[16]=e=>k.enable_b=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,{label:"警告规则："},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:k.rule,"onUpdate:modelValue":u[17]||(u[17]=e=>k.rule=e),type:"textarea",row:"5"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])],64)}}});const y=b;var f=y}}]);
//# sourceMappingURL=38.950a9583.js.map
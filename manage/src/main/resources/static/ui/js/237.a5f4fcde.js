"use strict";(self["webpackChunkstatic"]=self["webpackChunkstatic"]||[]).push([[237],{3945:function(e,a,l){l.r(a),l.d(a,{default:function(){return y}});l(7658);var t=l(3396),o=l(7139),u=l(1685),m=l(4870),p=l(4834),i=l(3824),r=l(7327),n=l(1799);class d{constructor(e,a,l,t){(0,r.Z)(this,"appName",void 0),(0,r.Z)(this,"dataCenter",void 0),(0,r.Z)(this,"ip",void 0),(0,r.Z)(this,"port",void 0),(0,r.Z)(this,"myChart",null),(0,r.Z)(this,"getKey",(()=>this.ip+":"+this.port)),(0,r.Z)(this,"queryData",(e=>{let a={appName:e.appName,quotaName:e.quotaName,dataCenter:this.dataCenter,ip:this.ip,port:this.port,timeType:e.timeType,time:e.time};(0,u.Z)({url:"/hmis/monitor/qd/queryQuotaDatas/v1.0",method:"post",data:a}).then((e=>{if(1==e.data.code){const a=e.data.body;let l=[],t=[];a.forEach((e=>{l.push(e.fmtCollectTime),t.push(e.dataValue)})),null==this.myChart&&(this.myChart=n.S1(document.getElementById(this.getKey()))),this.myChart.setOption({legend:{type:"plain"},tooltip:{trigger:"axis",formatter:"时间: {b}<br/>值: {c}"},xAxis:{data:l},yAxis:{},series:[{name:this.ip+":"+this.port,data:t,type:"line",symbolSize:0,label:{show:!1},areaStyle:{color:"#B1FF54A8",opacity:.3},lineStyle:{color:"#B1FF54A8",width:1}}]})}})).catch((e=>{(0,p.WI)("请求异常","error")}))})),(0,r.Z)(this,"resize",(()=>{this.myChart.resize()})),this.appName=e,this.dataCenter=a,this.ip=l,this.port=t}}const s={class:"time"},c=["id"],h={class:"dialog-footer"},w={class:"dialog-footer"};var b=(0,t.aZ)({__name:"QuotaList",setup(e){const a=(0,m.iH)(!1),l=(0,m.iH)(!1),r=(0,m.iH)("全屏"),n=(0,m.iH)("trend"),b=(0,m.qj)([]),f=()=>{l.value=!l.value,"全屏"==r.value?r.value="缩小":r.value="全屏",window.setTimeout((()=>{b.forEach((e=>e.resize()))}),500)},y=(0,m.qj)({quotaTypes:[{value:"Data",label:"数据"},{value:"Notify",label:"通知"},{value:"Heartbeat",label:"心跳"}]}),g=(0,m.qj)({page:{pageNum:1,pageSize:10,total:0},appName:"",quotaName:"",quotaDesc:"",quotaType:""}),W=(0,m.qj)({data:[]}),v=({row:e})=>"是"==e.hasThreshold?"warning-row":"",k=()=>{console.log("提交表单"),(0,u.Z)({url:"/hmis/monitor/rule/queryQuotaInfos/v1.0",method:"post",params:g.page,data:g}).then((e=>{1==e.data.code&&(W.data=e.data.body.list,g.page.total=e.data.body.total)})).catch((e=>{console.error(e),(0,p.WI)("请求异常","error")}))},N=(0,m.iH)(!1),_=(0,m.qj)({appName:"",quotaName:"",checkCount:3,notifyTimeoutSec:300,phoneNums:"",enable_b:!1,enable:-1,rule:""}),V=e=>{N.value=!0,_.appName=e.row.appName,_.quotaName=e.row.quotaName,_.enable=-1,(0,u.Z)({url:"/hmis/monitor/rule/queryAllQuotaWarnRules/v1.0",method:"post",data:_}).then((e=>{if(1==e.data.code){let a=e.data.body;if(a.length>0){let e=a[0];_.checkCount=e.checkCount,_.notifyTimeoutSec=e.notifyTimeoutSec,_.phoneNums=e.phoneNums,_.enable=e.enable,_.enable_b=1==e.enable,_.rule=e.rule}else _.checkCount=3,_.notifyTimeoutSec=300,_.phoneNums="",_.enable=0,_.enable_b=!1,_.rule=""}}))},q=()=>{N.value=!1,_.enable=_.enable_b?1:0,(0,u.Z)({url:"/hmis/monitor/rule/saveQuotaWarnRule/v1.0",method:"post",data:_}).then((e=>{1==e.data.code?(0,p.WI)("操作成功","success"):(0,p.WI)("操作失败","error")})).catch((e=>{(0,p.WI)("请求异常","error")}))},C=e=>{i.Z.push({path:"/monitor/instanceList",query:e.row})},U=()=>{const e=new Date;return e.setTime(e.getTime()-108e5),[e,new Date]},z=(0,m.iH)(!1),T=(0,m.qj)({timeType:"3",time:U(),appName:"",quotaName:""}),D=e=>{T.appName=e.row.appName,T.quotaName=e.row.quotaName,(0,u.Z)({url:"/hmis/manage/agent/kafkaIn/queryInstanceList/v1.0",method:"post",params:{pageNum:1,pageSize:100},data:{appName:e.row.appName}}).then((e=>{1==e.data.code&&(a.value=!0,b.length=0,e.data.body.list.forEach((e=>{b.push(new d(g.appName,e.dataCenter,e.ip,e.port))})),Z())})).catch((e=>{(0,p.WI)("请求异常","error")}))},S=()=>{"custom"==T.timeType?(z.value=!0,T.time=U()):(z.value=!1,T.time=[]),Z()},Z=()=>{b.forEach((e=>{e.queryData(T)}))};return(0,t.bv)((()=>k())),(e,u)=>{const m=(0,t.up)("el-input"),p=(0,t.up)("el-form-item"),i=(0,t.up)("el-option"),d=(0,t.up)("el-select"),U=(0,t.up)("el-button"),x=(0,t.up)("el-form"),H=(0,t.up)("el-table-column"),I=(0,t.up)("el-table"),j=(0,t.up)("el-pagination"),A=(0,t.up)("el-radio-button"),E=(0,t.up)("el-radio-group"),Q=(0,t.up)("el-date-picker"),F=(0,t.up)("el-dialog"),K=(0,t.up)("el-switch");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(x,{inline:!0,class:"demo-form-inline"},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{label:"应用名称",prop:"appName"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:g.appName,"onUpdate:modelValue":u[0]||(u[0]=e=>g.appName=e),placeholder:"请输入关键字..."},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,{label:"指标名称",prop:"quotaName"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:g.quotaName,"onUpdate:modelValue":u[1]||(u[1]=e=>g.quotaName=e),placeholder:"请输入关键字..."},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,{label:"指标描述",prop:"quotaDesc"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:g.quotaDesc,"onUpdate:modelValue":u[2]||(u[2]=e=>g.quotaDesc=e),placeholder:"请输入关键字..."},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,{label:"指标类型",prop:"quotaType"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:g.quotaType,"onUpdate:modelValue":u[3]||(u[3]=e=>g.quotaType=e),class:"m-2",placeholder:"请选择",size:"large"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(y.quotaTypes,((e,a)=>((0,t.wg)(),(0,t.j4)(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(U,{type:"primary",onClick:k},{default:(0,t.w5)((()=>[(0,t.Uk)("查询")])),_:1})])),_:1})])),_:1}),(0,t.Wm)(I,{data:W.data,style:{width:"100%"},border:!0,"table-layout":"fixed",size:"small","row-class-name":v},{default:(0,t.w5)((()=>[(0,t.Wm)(H,{fixed:"left",label:"操作",width:"150","header-align":"center",align:"center"},{default:(0,t.w5)((e=>[(0,t.Wm)(U,{link:"",type:"primary",size:"small",onClick:a=>V(e)},{default:(0,t.w5)((()=>[(0,t.Uk)("阈值")])),_:2},1032,["onClick"]),(0,t.Wm)(U,{link:"",type:"primary",size:"small",onClick:a=>C(e)},{default:(0,t.w5)((()=>[(0,t.Uk)("实例")])),_:2},1032,["onClick"]),(0,t.Wm)(U,{link:"",type:"primary",size:"small",onClick:a=>D(e)},{default:(0,t.w5)((()=>[(0,t.Uk)("趋势")])),_:2},1032,["onClick"])])),_:1}),(0,t.Wm)(H,{prop:"hasThreshold",label:"是否配置阈值","show-overflow-tooltip":!0,"header-align":"center"}),(0,t.Wm)(H,{prop:"appName",label:"应用名称","show-overflow-tooltip":!0,"header-align":"center"}),(0,t.Wm)(H,{prop:"quotaName",label:"指标名称","show-overflow-tooltip":!0,"header-align":"center"}),(0,t.Wm)(H,{prop:"quotaDesc",label:"指标描述","show-overflow-tooltip":!0,"header-align":"center"}),(0,t.Wm)(H,{prop:"quotaUnit",label:"指标单位","show-overflow-tooltip":!0,"header-align":"center"}),(0,t.Wm)(H,{prop:"quotaType",label:"指标类型","show-overflow-tooltip":!0,"header-align":"center"}),(0,t.Wm)(H,{prop:"cycleTime",label:"采集周期","show-overflow-tooltip":!0,"header-align":"center"}),(0,t.Wm)(H,{prop:"cycleUnit",label:"周期单位","show-overflow-tooltip":!0,"header-align":"center"})])),_:1},8,["data"]),(0,t.Wm)(j,{class:"page","page-size":g.page.pageSize,"onUpdate:page-size":u[4]||(u[4]=e=>g.page.pageSize=e),"current-page":g.page.pageNum,"onUpdate:current-page":u[5]||(u[5]=e=>g.page.pageNum=e),layout:"->, total, sizes, prev, pager, next, jumper",total:g.page.total,"onUpdate:total":u[6]||(u[6]=e=>g.page.total=e),onSizeChange:k,onCurrentChange:k,onPrevClick:k,onNextClick:k,small:!0,background:!0,"page-sizes":[5,10,20,50,100]},null,8,["page-size","current-page","total"]),(0,t.Wm)(F,{modelValue:a.value,"onUpdate:modelValue":u[10]||(u[10]=e=>a.value=e),title:T.quotaName,"destroy-on-close":"",fullscreen:l.value,top:"5vh"},{footer:(0,t.w5)((()=>[(0,t._)("span",h,[(0,t.Wm)(U,{onClick:Z,type:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)("查询")])),_:1}),(0,t.Wm)(U,{onClick:f,type:"success"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,o.zw)(r.value),1)])),_:1}),(0,t.Wm)(U,{onClick:u[9]||(u[9]=e=>a.value=!1),type:"info"},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1})])])),default:(0,t.w5)((()=>[(0,t.Wm)(x,{model:T},{default:(0,t.w5)((()=>[(0,t.Wm)(E,{modelValue:T.timeType,"onUpdate:modelValue":u[7]||(u[7]=e=>T.timeType=e),onChange:S},{default:(0,t.w5)((()=>[(0,t.Wm)(A,{label:"1",size:"small",border:""},{default:(0,t.w5)((()=>[(0,t.Uk)("最近1小时")])),_:1}),(0,t.Wm)(A,{label:"3",size:"small",border:""},{default:(0,t.w5)((()=>[(0,t.Uk)("最近3小时")])),_:1}),(0,t.Wm)(A,{label:"6",size:"small",border:""},{default:(0,t.w5)((()=>[(0,t.Uk)("最近6小时")])),_:1}),(0,t.Wm)(A,{label:"12",size:"small",border:""},{default:(0,t.w5)((()=>[(0,t.Uk)("最近12小时")])),_:1}),(0,t.Wm)(A,{label:"24",size:"small",border:""},{default:(0,t.w5)((()=>[(0,t.Uk)("最近24小时")])),_:1}),(0,t.Wm)(A,{label:"custom",size:"small",border:""},{default:(0,t.w5)((()=>[(0,t.Uk)("自定义")])),_:1})])),_:1},8,["modelValue"]),(0,t._)("div",s,[z.value?((0,t.wg)(),(0,t.j4)(Q,{key:0,modelValue:T.time,"onUpdate:modelValue":u[8]||(u[8]=e=>T.time=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",size:"small"},null,8,["modelValue"])):(0,t.kq)("",!0)])])),_:1},8,["model"]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(b,((e,a)=>((0,t.wg)(),(0,t.iD)("div",{id:e.ip+":"+e.port,class:(0,o.C_)(n.value)},null,10,c)))),256))])),_:1},8,["modelValue","title","fullscreen"]),(0,t.Wm)(F,{modelValue:N.value,"onUpdate:modelValue":u[19]||(u[19]=e=>N.value=e),title:"趋势图","destroy-on-close":"",top:"5vh"},{footer:(0,t.w5)((()=>[(0,t._)("span",w,[(0,t.Wm)(U,{onClick:q,type:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)("保存")])),_:1}),(0,t.Wm)(U,{onClick:u[18]||(u[18]=e=>N.value=!1),type:"info"},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1})])])),default:(0,t.w5)((()=>[(0,t.Wm)(x,{model:_,"label-width":"120px"},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{label:"应用名称："},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:_.appName,"onUpdate:modelValue":u[11]||(u[11]=e=>_.appName=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,{label:"指标名称："},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:_.quotaName,"onUpdate:modelValue":u[12]||(u[12]=e=>_.quotaName=e),disabled:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,{label:"检查次数："},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:_.checkCount,"onUpdate:modelValue":u[13]||(u[13]=e=>_.checkCount=e),type:"number"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,{label:"警告超时(秒)："},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:_.notifyTimeoutSec,"onUpdate:modelValue":u[14]||(u[14]=e=>_.notifyTimeoutSec=e),type:"number"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,{label:"通知号码："},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:_.phoneNums,"onUpdate:modelValue":u[15]||(u[15]=e=>_.phoneNums=e),type:"textarea",row:"5"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,{label:"是否启用："},{default:(0,t.w5)((()=>[(0,t.Wm)(K,{modelValue:_.enable_b,"onUpdate:modelValue":u[16]||(u[16]=e=>_.enable_b=e),"inline-prompt":"","active-text":"是","inactive-text":"否"},null,8,["modelValue"])])),_:1}),(0,t.Wm)(p,{label:"警告规则："},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:_.rule,"onUpdate:modelValue":u[17]||(u[17]=e=>_.rule=e),type:"textarea",row:"5"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])],64)}}});const f=b;var y=f}}]);
//# sourceMappingURL=237.a5f4fcde.js.map